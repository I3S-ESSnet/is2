<!-- 
 Copyright 2019 ISTAT

 Licensed under the EUPL, Version 1.1 or - as soon they will be approved by
 the European Commission - subsequent versions of the EUPL (the "Licence");
 You may not use this work except in compliance with the Licence. You may
 obtain a copy of the Licence at:

 http://ec.europa.eu/idabc/eupl5

 Unless required by applicable law or agreed to in writing, software
 distributed under the Licence is distributed on an "AS IS" basis, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 Licence for the specific language governing permissions and limitations under
 the Licence.

 @author Francesco Amato <framato @ istat.it>
 @author Mauro Bruno <mbruno @ istat.it>
 @author Paolo Francescangeli  <pafrance @ istat.it>
 @author Renzo Iannacone <iannacone @ istat.it>
 @author Stefano Macone <macone @ istat.it>
 @version 1.0
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<head th:include="layout :: site-head" th:remove="tag" />
<meta name="ctx" th:content="${#httpServletRequest.getContextPath()}" />
<script th:src="@{/js/table/datatables.js}"></script>
<script th:src="@{/js/table/buttons.colVis.min.js}"></script>
<script th:src="@{/js/rulesetpreview.js}"></script>
<link rel="stylesheet" th:href="@{/css/table/datatables.css}" />
<script th:inline="javascript">
	$(document).ready(function() {
		setMenuActive("regole");
	});
</script>
</head>
<body>
	<!-- Body -->
	<div class="wrapper">
		<header th:replace="layout :: site-header"></header>
		<aside th:replace="layout :: site-aside"></aside>
		<!-- START MAIN CONTAINER -->
		<section>
			<!-- Begin breadcrumb -->
			<div class="content-wrapper">
				<!-- Begin breadcrumb -->
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a class=""
							title="chiudi sessione lavoro workflow"
							th:href="@{'/sessione/apri/'+${session.sessioneBean.id}}"> <span
								th:if="${session.sessionelv}"> <span
									th:text="${session.sessionelv.nome}"></span>
							</span>
						</a></li>
						<li class="breadcrumb-item"><a class=""
							title="Chiudi ruleset"
							th:href="@{'/rule/viewRuleset/'+${session.sessioneBean.id}}">
								<span th:if="${session.sessionelv}"> <span
									th:text="#{sessionewf.listaruleset}"></span>
							</span>
						</a></li>
						<li class="breadcrumb-item"><span
							th:text="${ruleset.nomeFile}"></span></li>

						<div class="btn-group pull-right" role="group">
							<a class="" title="Chiudi sessione"
								th:href="@{'/rule/viewRuleset/'+${session.sessioneBean.id}}">
								<i class="fa fa-close"></i>&nbsp;<span th:text="#{Layout.Close}"></span>
							</a>
						</div>
					</ol>
				</nav>
				<!-- End breadcrumb -->
				<div class="container-fluid">

					<!-- TEST DIV case SELECTED dataset for ruleset -->
					<div class="row">
						<div class="col-lg-7">
							<div class="card">
								<div class="card-header">
									<span th:text="${ruleset.labelFile}"></span>
									<div class="card-header-actions">
										<a class="card-header-action" href="javascript:void(0)"
											th:onclick="'javascript:runValidate(' + ${ruleset.id} + ')'"
											title="Nuova regola"> <i
											class="fa fa-caret-square-o-right"></i>&nbsp;<span
											th:text="#{ruleset.package.validate.contrad}"></span>
										</a> <a class="card-header-action" href="javascript:void(0)"
											th:onclick="'javascript:runValidate(' + ${ruleset.id} + ')'"
											title="Nuova regola"> <i
											class="fa fa-caret-square-o-right"></i>&nbsp;<span
											th:text="#{ruleset.package.validate.redundant}"></span>
										</a>
									</div>
								</div>
								<div class="card-body">
									<table id="dataview" class="table table-striped "
										cellspacing="0" width="auto" style="overflow: auto;">
										<thead>
											<tr>
												<th>Regola</th>
												<th>Variabile</th>
												<th>Classificazione</th>
												<th width="1%"></th>
												<th width="1%"></th>
												<th width="1%"></th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="rule : ${rules}"
												th:classappend="${rule.errcode > 0} ? table-warning : table-ok">
												<td><span
													th:text="${#strings.abbreviate(rule.rule,50)}"
													th:title="${rule.rule}"></span></td>
												<td><span th:if="${session.dfile != null}"
													th:text="${#strings.abbreviate(rule.sxRuleset.datasetFile.getNomeColFormId(rule.variabile),50)}"
													th:title="${rule.variabile}"></span></td>
												<td th:if="${ rule.sxClassification != null }"><span
													th:text="${#strings.abbreviate(rule.sxClassification.nome,50)}"
													th:title="${rule.sxClassification.nome}"></span></td>
												<td th:unless="${ rule.sxClassification != null }"><span></span></td>
												<td style="width: 1%"><a th:if="${rule.errcode > 0}"
													href="javascript:void(0)"
													th:title="#{ruleset.package.validate.incoherent}"
													role="button"
													th:attr="onclick='javascript:runIsContradicted(' + ${rule.id} + ')'">
														<i class="fa fa-wrench"></i>
												</a></td>
												<td style="width: 1%"><a href="javascript:void(0)"
													title="Edit regola" role="button"
													th:attr="onclick='javascript:editRule(' + ${rule.id} + ', \'' + ${rule.rule} + '\', \'' + ${rule.descr}+ '\', \'' + ${rule.sxClassification.id} +'\')'">


														<i class="fa fa-edit"></i>
												</a></td>
												<td style="width: 1%"><a href="javascript:void(0)"
													title="Delete" role="button"
													th:attr="onclick='javascript:deleteRule(' + ${rule.id} + ', \'' + ${rule.rule} + '\')'">
														<i class="fa fa-trash-o"></i>
												</a></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="card" th:if="${session.dfile != null}"
								id="dataset_div">
								<div class="card-header">
									<span th:text="${session.dfile.nomeFile}">Nome dataset</span>
									<div class="btn-group pull-right" role="group">
										<a class="" title="Chiudi riquadro" href="javascript:void(0)"
											th:attr="onclick='javascript:chiudiDivVariabili()'"> <i
											class="fa fa-close"></i>&nbsp;<span th:text="#{Layout.Close}"></span>
										</a>
									</div>
								</div>

								<div class="card-body">
									<table id="metadataTab"
										class="table table-bordered table-hover">
										<thead>
											<tr>
												<th><span>Nome Variabile</span></th>
												<th style="width: 5%"></th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="cols: ${session.dfile.colonne}"
												th:unless="${(session.dfile.colonne == null) or (session.dfile.colonne.size() == 0) }">
												<td><span th:text="${cols.nome}"></span></td>
												<td align="center"><a href="javascript:void(0)"
													th:unless="${cols.tipoVariabile}"
													th:attr="onclick='javascript:addRule('+${cols.id}+',\''+${cols.nome}+ '\')'"
													title="Aggiungi regola"> <i class="fa fa-plus-square-o"></i>
												</a> <input type="hidden" name="colsid" th:value="${cols.id}" />
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>

						</div>

						<div class="col-lg-5">
						
						
							<div class="card">
							
							
								<div class="card-header">
								<!-- TEST TABS -->
								
								
								<div class="navbar-collapse collapse">
									<ul class="nav navbar-nav">
										<li class="active"><a data-toggle="tab" href="#tab1"
											th:text="#{Layout.log.panel}">Log panel </a></li>
	
										<li><a data-toggle="tab" href="#tab2"
											th:text="#{Layout.r.panel}">R output </a></li>
									</ul>
									</div>
								</div>
								
								
								
								
								<div class="tab-content">

									<div id="tab1" class="tab-pane fade  in active">
										<div class="card-header-actions">
											<a class="card-header-action" href="javascript:void(0)"
												th:onclick="'javascript:clearLog(\'' + ${session.sessioneBean.id} + '\')'"
												title="Clear log"> <i class="fa fa-trash-o"></i>
											</a>
										</div>
										<div id="logbox" class="card-body">
											<ul th:if="${logs.size()>0}">
												<li th:each="log : ${logs}"><span
													th:text="${#dates.format(log.msgTime, 'dd/MM/yyyy HH:mm')}"></span>&nbsp;&ndash;&nbsp;<span
													th:text="${log.msg}"></span></li>
											</ul>
											<span th:unless="${logs.size()>0}"> No message
												available </span>
										</div>
									</div>
									<div id="tab2" class="tab-pane fade">
										<div class="card-header-actions">
											<a class="card-header-action" href="javascript:void(0)"
												th:onclick="'javascript:clearRLog(\'' + ${session.sessioneBean.id} + '\')'"
												title="Clear log"> <i class="fa fa-trash-o"></i>
											</a>
										</div>
										<div id="rbox" class="card-body">
											<ul th:if="${rlogs.size()>0}">
												<li th:each="rlog : ${rlogs}"><span
													th:text="${#dates.format(rlog.msgTime, 'dd/MM/yyyy HH:mm')}"></span>&nbsp;&ndash;&nbsp;<span
													th:text="${rlog.msg}"></span></li>
											</ul>
											<span th:unless="${rlogs.size()>0}"> No message
												available </span>
										</div>
									</div>
									
									
									</div>
								
							</div>
						</div>
					</div>
				</div>
			</div>
	
	</section>
	<!-- END MAIN CONTAINER -->
	<footer th:replace="layout :: site-footer" />
	</div>
	<form id="inputNewRuleForm" th:action="@{'/rule/newRule'}"
		method="post" enctype="multipart/form-data">
		<input type="hidden" value="" name="ruleText" id="ruleText" /> <input
			type="hidden" value="" name="ruleDesc" id="ruleDesc" />
		<!-- input type="hidden" value="" name="ruleType" id="ruleType" /-->
		<input type="hidden" value="" name="classification"
			id="classification" /> <input type="hidden"
			th:value="${session.sessioneBean.id}" th:name="idsessione" /> <input
			type="hidden" th:value="${ruleset.id}" th:name="idruleset" /> <input
			type="hidden" th:name="idcol" id="idcol" />

	</form>
	<!-- New Rule Dialog -->
	<div class="modal fade" id="newruledialog" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">
						<i class="fa fa-plus-square"></i>&nbsp; <span
							th:text="#{rules.new.rule.dialog.title}">Nuova regola</span>
					</h4>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{ruleset.rule}">Regola:</span> &nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<input id="rule_text" value="" type="text" />
						</div>
					</div>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{rules.new.ruleset.desc}">Descrizione:</span>
							&nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<input id="rule_desc" value="" type="text" />
						</div>
					</div>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{ruleset.classification.label}">Classificazione:</span>
							&nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<select id="classification_l">
								<option th:each="classificazione : ${listaClassificazioni}"
									th:value="${classificazione.id}"
									th:text="${classificazione.nome}"></option>
							</select>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">
						<span th:text="#{Userlist.close}"
							th:title="#{generic.title.close.button}">Close</span>
					</button>
					<button type="button" id="btn-invia-new-rule"
						class="btn btn-primary towait" onclick="inviaFormNewRule();"
						th:title="#{generic.title.submit.button}">
						<span th:text="#{Userlist.save}">Salva</span>
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Fine New Rule Dialog -->
	<!-- New Rule Dialog -->
	<div class="modal fade" id="addrulevariable" tabindex="-1"
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">
						<i class="fa fa-plus-square"></i>&nbsp; <span
							th:text="#{rules.new.rule.domain.title}">Nuova regola di
							dominio</span>
					</h4>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{ruleset.variable.label}">Variabile:</span>
							&nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<span id="nome_var"> </span>
						</div>
					</div>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{ruleset.rule}">Regola:</span> &nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<input id="rule_text_v" value="" type="text" />
						</div>
					</div>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{rules.new.ruleset.desc}">Descrizione:</span>
							&nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<input id="rule_desc_v" value="" type="text" />
						</div>
					</div>
				</div>
				<div class="modal-body row">
					<div class="col-lg-12">
						<div class="col-lg-4 text-right">
							<span th:text="#{ruleset.classification.label}">Classificazione:</span>
							&nbsp;&nbsp;&nbsp;
						</div>
						<div class="col-lg-8">
							<select id="classification_v">
								<option th:each="classificazione : ${listaClassificazioni}"
									th:value="${classificazione.id}"
									th:text="${classificazione.nome}"></option>
							</select>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">
						<span th:text="#{Userlist.close}"
							th:title="#{generic.title.close.button}">Close</span>
					</button>
					<button type="button" id="btn-invia-new-rule"
						class="btn btn-primary towait" onclick="inviaFormNewVarRule();"
						th:title="#{generic.title.submit.button}">
						<span th:text="#{Userlist.save}">Salva</span>
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Fine New Rule Dialog -->
	<!-- Modal Delete-->
	<div class="modal fade" id="modalDeleteRule" tabindex="-1"
		role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<input type="hidden" id="ruleId" />
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="exampleModalLabel">
						<i class="fa fa-trash"></i>&nbsp;<span>Conferma
							eliminazione</span>
					</h4>
				</div>
				<div class="modal-body">
					Eliminare la regola &nbsp;<span></span>?
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">
						<span th:text="#{Userlist.close}"
							th:title="#{generic.title.close.button}">Close</span>
					</button>
					<button type="button" id="btnDelete" class="btn btn-primary towait"
						th:title="#{generic.delete.button.label}">
						<span th:text="#{generic.delete.button.label}">Elimina</span>
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal Edit-->
	<div class="modal fade" id="modalEditRule" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">
						<i class="fa fa-pencil"></i> <span th:text="#{ruleset.rule.edit}">Edit
							regola</span>
					</h4>
				</div>
				<div class="modal-body form">
					<form action="#" id="editForm" class="form-horizontal">
						<input type="hidden" value="" name="ruleId" id="editRuleId" /> <input
							type="hidden" value="10" name="ruleSetId" id="editRuleId" />
						<div class="form-body">
							<div id="msgs"></div>
							<div class="form-group row">
								<div class="modal-body row">
									<div class="col-lg-12">
										<div class="col-lg-4 text-right">
											<label class="control-label" th:text="#{rule.edit.label}">Regola</label>
										</div>
										<div class="col-lg-8">
											<input name="rule" placeholder="Rule" class="form-control"
												title="Rule" type="text" id="editRuleText" /> <span
												class="help-block"></span>
										</div>
									</div>
								</div>
								<div class="modal-body row">
									<div class="col-lg-12">
										<div class="col-lg-4 text-right">
											<label class="control-label"
												th:text="#{generic.label.description.colon}">Descrizione:</label>
										</div>
										<div class="col-lg-8">
											<input name="descrizione"
												th:placeholder="#{generic.label.description}"
												class="form-control" title="Descrizione" type="text"
												id="descrizione_edit" /> <span class="help-block"></span>
										</div>
									</div>
								</div>
								<div class="modal-body row">
									<div class="col-lg-12">
										<div class="col-lg-4 text-right">
											<label th:text="#{ruleset.classification.label}">Classificazione:</label>
										</div>
										<div class="col-lg-8">
											<select name="classificazione" id="classification_edit">
												<option th:each="classificazione : ${listaClassificazioni}"
													th:value="${classificazione.id}"
													th:text="${classificazione.nome}"></option>
											</select>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">
						<span th:text="#{Userlist.close}"
							th:title="#{generic.title.close.button}">Close</span>
					</button>
					<button type="button" id="btnEdit" class="btn btn-primary towait"
						th:title="#{generic.title.submit.button}">
						<span th:text="#{Userlist.save}">Save</span>
					</button>
				</div>
			</div>
		</div>
	</div>
	
</body>
</html>